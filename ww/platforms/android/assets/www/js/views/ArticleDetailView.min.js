define(["text!templates/article/article-detail-tpl.html"],function(e){var t=function(){this.initialize=function(){this.$el=$("<div/>");this.$el.html($wwCompile(e)(getScope()));this.hash=window.location.hash.substr(1)};this.clearData=function(){this.$el.find("#article-detail-content").hide();setScope("currentArticle",{})};this.render=function(e){var t=this;t.$el.wwViewLoader();window.articleService.findById(e).done(function(e){t.$el.wwViewLoader("R");e.content=$wwSce.trustAsHtml(e.content);e.isCreator=window.user&&window.user.userId===(e.author?e.author.userId:-1);setScope("currentArticle",e);t.$el.find(".ww-item-content img").each(function(){$(this).load(function(){}).attr("src",context_root+$(this).attr("data-src"))});e._content=t.$el.find(".ww-item-content").html();t.$el.find("#article-detail-content").show();t._scrollLoader=t.$el.find("#article-detail-content").wwScrollLoader({loadBottom:null,pull:null,pullEnd:null,onScroll:function(e){if(e<t.$el.find(".title-block h4").height()){setScope("currentArticle",$.extend(getScope("currentArticle"),{_showTitle:false}))}else{setScope("currentArticle",$.extend(getScope("currentArticle"),{_showTitle:true}))}}})});return t};this.bindEvents=function(){var e=this;e.$el.off("click.lefNav").on("click.lefNav",".icon-left-nav",function(){window.backHandler()});e.$el.off("click.actions").on("click.actions",".bar-tab a.edit-article",function(){var e=getScope("currentArticle");window.location.href="#ww/detail/"+e.weijian._id+"/article/edit/"+e._id});e.$el.off("click.comment-article").on("click.comment-article",".bar-tab .comment-article",function(){var e=getScope("currentArticle");window.location.href="#ww/detail/"+e.weijian._id+"/article/detail/"+e._id+"/comments"});var t=function(e,t,i){var c=e+"d";if(e=="watch"||e=="collect"){c=e+"ed"}c="article"+c[0].toUpperCase()+c.substr(1);if(t&&t[e]!=undefined){var n={};n[e]=t[e];n[c]=t[c];setScope("currentArticle",$.extend(getScope("currentArticle"),n));alert(i)}};e.$el.off("click.agree-article").on("click.agree-article",".agree-article",function(){var e=getScope("currentArticle");if(e.articleAgreed){window.articleService.agreeOn(e._id,-1).done(function(e){t("agree",e,"已取消点赞")})}else{window.articleService.agreeOn(e._id,1).done(function(e){t("agree",e,"已点赞")})}});e.$el.off("click.bookmark-article").on("click.bookmark-article",".bookmark-article",function(){var e=getScope("currentArticle");if(e.articleCollected){window.articleService.collectOn(e._id,-1).done(function(e){t("collect",e,"已取消收藏")})}else{window.articleService.collectOn(e._id,1).done(function(e){t("collect",e,"已收藏")})}});return e};this.initialize()};return t});