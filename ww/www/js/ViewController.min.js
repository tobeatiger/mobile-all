define(["LoginService","WWService","ArticleService","LoginView","MainView","SearchView","WWDetailView","WWCreateView","WWCreateTagsView","ArticleCreateView","ArticleDetailView","CommentsView"],function(e,i,n,t,r,d,o,w,a,c,l,s){window.wwActions={newWW:"newWW",editWW:"editWW",newArticle:"newArticle",editArticle:"editArticle"};window.wwService=i;window.articleService=n;window.loginService=e;var u;var f=(new r).render().bindEvents();var g=(new d).render().bindEvents();var v=new w(wwActions.newWW).render().bindEvents();var W=new a(wwActions.newWW).render().bindEvents();var A=new w(wwActions.editWW).render().bindEvents();var b=new a(wwActions.editWW).render().bindEvents();var h=new c(wwActions.newArticle).render().bindEvents();var E=new c(wwActions.editArticle).render().bindEvents();var V;var R;var m={start:function(){u=new t(m).render().bindEvents();loginService.checkLogin(false).done(function(e){window.user=e;m.switchView("main")}).fail(function(){m.switchView("login")});$(document).ajaxError(function(e,i,n,t){if(i.status==403){window.wwConfirm("要去登录/注册吗？",function(e){if(e){m.switchView("login")}},"还未登录",["是的","等等再说"])}})},switchView:function(e){if(e=="login"){slider.slidePage(u.$el);window.location.href="#login"}else if(e=="main"){window.location.href="#ww";router.addRoute("ww",function(){f.changeView("ww",slider)});router.addRoute("ww/search",function(){slider.slidePage(g.$el);g.setFocus()});router.addRoute("ww/detail/:id",function(e){if(!V){V=(new o).bindEvents()}if(window._nav_backing){slider.slidePage(V.$el)}else{V.clearData();slider.slidePage(V.$el,function(){V.render(e)})}});router.addRoute("ww/detail/:id/comments",function(e){var i=new s(e,null,"ww").bindEvents();slider.slidePage(i.$el,function(){i.render()})});router.addRoute("ww/detail/:wwId/article/detail/:articleId/comments",function(e,i){var n=new s(e,i,"article").bindEvents();slider.slidePage(n.$el,function(){n.render()})});router.addRoute("ww/create",function(){loginService.checkLogin().done(function(){setScope("action",wwActions.newWW);slider.slidePage(v.$el);v.createEditorOnce()}).fail(function(){window.backHandler()})});router.addRoute("ww/create/tags",function(){slider.slidePage(W.$el)});router.addRoute("ww/edit",function(){loginService.checkLogin().done(function(){setScope("action",wwActions.editWW);slider.slidePage(A.$el);A.createEditorOnce();A.initWWData()}).fail(function(){window.backHandler()})});router.addRoute("ww/edit/tags",function(){slider.slidePage(b.$el);b.initWWTags()});router.addRoute("ww/detail/:wjId/article/create",function(){loginService.checkLogin().done(function(){setScope("action",wwActions.newArticle);slider.slidePage(h.$el);h.createEditorOnce();h.initData()}).fail(function(){window.backHandler()})});router.addRoute("ww/detail/:wjId/article/edit/:articleId",function(e,i){loginService.checkLogin().done(function(){setScope("action",wwActions.editArticle);slider.slidePage(E.$el);E.createEditorOnce();E.initData(e,i)}).fail(function(){window.backHandler()})});router.addRoute("ww/detail/:wjId/article/detail/:articleId",function(e,i){if(!R){R=(new l).bindEvents()}if(window._nav_backing){slider.slidePage(R.$el)}else{R.clearData();slider.slidePage(R.$el,function(){R.render(i)})}});router.addRoute("hot",function(){f.changeView("hot",slider)});router.addRoute("messages",function(){f.changeView("messages",slider)});router.addRoute("myww",function(){f.changeView("myww",slider)});router.addRoute("me",function(){f.changeView("me",slider)});router.setPostRoute(function(){window._nav_backing=false});router.start()}}};return m});