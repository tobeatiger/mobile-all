define(["text!templates/article/article-creation.html"],function(e){var t=function(t){this.initialize=function(){this.$el=$("<div/>");this.$el.html($wwCompile(e)(getScope()));setScope(t,{});setScope(t+"TitleChange",this._titleChange.bind(this))};this._titleChange=function(){var e=this.$el.find("textarea");if(e.prop("scrollHeight")>42){e.css("padding-top","0px")}else{e.css("padding-top","10px")}};this.render=function(){return this};this.bindEvents=function(){var e=this.$el;e.find("a.icon-left-nav").off("click").click(function(){window.backHandler()});e.find("#article-save").off("click").click(function(){var i=e.find(".ql-editor");var n=getScope(t);if(n.title&&n.title.trim().length>4&&(i.text().trim().length>9||i.find("img").length>0)){setScope(t,$.extend(n,{content:i.html()}));articleService.createOrUpdate(t,n).done(function(e){history.pushState({},"","#ww");history.pushState({},"","#ww/detail/"+n.weijianId);window.location.href="#ww/detail/"+n.weijianId+"/article/detail/"+e._id;setTimeout(function(){setScope(t,{});alert(t==window.wwActions.newArticle?"创建成功":"修改成功")},400)}).fail(function(){alert(t==window.wwActions.newArticle?"哎呀，创建出了点问题":"哎呀，修改出了点问题")})}else{alert("标题至少 5 个字，内容至少 10 个字")}});return this};this.createEditorOnce=function(){var e=this;if(!e.quill){e.quill=new Quill("#article-create-quill-editor",{modules:{toolbar:[["bold","blockquote","link","image"]]},placeholder:"编辑为论",theme:"snow"});document.addEventListener("selectionchange",function(){e.quill.getSelection()},false);var t=e.quill.getModule("toolbar");$.addQHandler("image",t);$.addQHandler("link",t)}return e};this.initData=function(){if(t==window.wwActions.newArticle){var e=getScope("currentWW");setScope(t,{weijianId:e._id,title:"[论]"+e.title})}else{var i=getScope("currentArticle");i.weijianId=i.weijian._id;setScope(t,i);this.$el.find(".ql-editor").html(i._content);this._titleChange()}};this.initialize()};return t});